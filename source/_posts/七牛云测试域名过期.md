---
title: ä¸ƒç‰›äº‘æµ‹è¯•åŸŸåè¿‡æœŸ
date: 2018-12-15 11:06:25
tags:
---

ä¸ƒç‰›äº‘æµ‹è¯•åŸŸåä¸€ä¸ªæœˆå›æ”¶äº†ï¼Œæœ‰äº›å›¾ç‰‡æ˜¾ç¤ºä¸å‡ºæ¥äº†ï¼Œå‰©ä¸‹çš„ä¹Ÿä¸èƒ½ç›´æ¥ä¸‹è½½ï¼Œä½œä¸ºä¸€åªç¨‹åºğŸ’ï¼Œæ‰‹åŠ¨æ‰“å¼€é“¾æ¥å¹¶ä¸”ä¿å­˜å›¾ç‰‡çš„äº‹æƒ…è‡ªç„¶æ˜¯åšä¸å‡ºæ¥çš„ï¼Œè¿™è¾ˆå­éƒ½ä¸å¯èƒ½åšçš„ï¼Œå®æ„¿æ—¶é—´èŠ±åœ¨å†™å·¥å…·ä¸Šï¼Œå½“ç„¶ä¹Ÿæœ‰[è§£å†³æ–¹æ¡ˆ](https://blog.csdn.net/lkj345/article/details/83382636)ã€‚ç„¶é¹…æ›´æ„¿æ„ç”¨è‡ªå·±çš„æ–¹å¼è§£å†³é—®é¢˜ã€‚

#### ä½¿ç”¨[puppeteer](https://qinhanwen.github.io/2018/11/16/puppeteer%E5%B0%8F%E8%AF%95%E7%89%9B%E5%88%80/)æ¥è§£å†³é—®é¢˜

```javascript
const puppeteer = require('puppeteer');

function timeout(delay) {
    return new Promise(resolve => {
        setTimeout(
            () => {
                resolve()
            }, delay
        )
    })
}

var userInfo = {
    name: 'è´¦å·',
    pwd: 'å¯†ç ',
    domaiName: 'æµ‹è¯•åŸŸå'
};

(async () => {
    const browser = await puppeteer.launch({
        executablePath: './chrome-mac/Chromium.app/Contents/MacOS/Chromium',
        headless: false
    });//æ— å¤´æ¨¡å¼é»˜è®¤æ˜¯trueï¼Œè®¾ç½®ä¸ºfalse
    const page = await browser.newPage();
    const viewConfig = {
        width: 1080,
        height: 1920
    };
    //è®¾ç½®çª—å£ 
    page.setViewport(viewConfig);
    await page.goto('https://portal.qiniu.com/bucket/picture/resource');

    page.on('error', (err) => {
        console.log(err);
    })

    //ç™»å½•
    await page.waitForSelector('#email');
    await page.type('#email', userInfo.name);
    await page.type('#password', userInfo.pwd);
    await page.tap('#login-button');

    //ç‚¹å‡»å·¦ä¾§ å¯¹è±¡å­˜å‚¨çš„æŒ‰é’®
    await page.waitForSelector('.sidebar-item');
    const sidebarList = await page.$$('.sidebar-item');
    await sidebarList[4].tap();

    //ç‚¹å‡»å†…å®¹ç®¡ç†
    await page.waitForSelector('.basic-operation>a');
    await timeout(3000);
    const breadcrumbList = await page.$$('.basic-operation>a');
    await breadcrumbList[2].tap();

    //ç‚¹å‡»åŠ è½½æ›´å¤š
    await timeout(3000);
    await page.waitForSelector('.text-center>a');
    await page.tap('.text-center>a');

    //è·å–åˆ—è¡¨å›¾ç‰‡åç§°ä¿¡æ¯
    await timeout(3000);
    await page.waitForSelector('.file-td');
    let list = await page.$$eval('.file-td', el => {
        let arr = [];
        const len = el.length;
        for(let i=0;i<len;i++){
            arr.push(el[i].textContent);
        }
        return arr;
    });
    console.log(list);
    await browser.close();
})();
```



#### æ‹¿åˆ°äº†å›¾ç‰‡çš„åç§°ï¼Œæƒ³åˆ°ä¸¤å¼ æ–¹å¼æ¥ä¸‹è½½

##### 1.ç¬¬ä¸€ç§ï¼Œå°±ä½¿ç”¨puppeteerçš„æˆªå›¾ï¼Œç›´æ¥è´´å…¨éƒ¨ä»£ç 

```javascript
const puppeteer = require('puppeteer');

function timeout(delay) {
    return new Promise(resolve => {
        setTimeout(
            () => {
                resolve()
            }, delay
        )
    })
}

var userInfo = {
    name: 'è´¦å·',
    pwd: 'å¯†ç ',
    domaiName: 'æµ‹è¯•åŸŸå'
};

(async () => {
    const browser = await puppeteer.launch({
        executablePath: './chrome-mac/Chromium.app/Contents/MacOS/Chromium',
        headless: false
    });//æ— å¤´æ¨¡å¼é»˜è®¤æ˜¯trueï¼Œè®¾ç½®ä¸ºfalse
    const page = await browser.newPage();
    const viewConfig = {
        width: 1080,
        height: 1920
    };
    //è®¾ç½®çª—å£ 
    page.setViewport(viewConfig);
    await page.goto('https://portal.qiniu.com/bucket/picture/resource');

    page.on('error', (err) => {
        console.log(err);
    })

    //ç™»å½•
    await page.waitForSelector('#email');
    await page.type('#email', userInfo.name);
    await page.type('#password', userInfo.pwd);
    await page.tap('#login-button');

    //ç‚¹å‡»å·¦ä¾§ å¯¹è±¡å­˜å‚¨çš„æŒ‰é’®
    await page.waitForSelector('.sidebar-item');
    const sidebarList = await page.$$('.sidebar-item');
    await sidebarList[4].tap();

    //ç‚¹å‡»å†…å®¹ç®¡ç†
    await page.waitForSelector('.basic-operation>a');
    await timeout(3000);
    const breadcrumbList = await page.$$('.basic-operation>a');
    await breadcrumbList[2].tap();

    //ç‚¹å‡»åŠ è½½æ›´å¤š
    await timeout(3000);
    await page.waitForSelector('.text-center>a');
    await page.tap('.text-center>a');

    //è·å–åˆ—è¡¨å›¾ç‰‡åç§°ä¿¡æ¯
    await timeout(3000);
    await page.waitForSelector('.file-td');
    let list = await page.$$eval('.file-td', el => {
        let arr = [];
        const len = el.length;
        for (let i = 0; i < len; i++) {
            arr.push(el[i].textContent);
        }
        arr.splice(0,1);
        return arr;
    });
    
    //æˆªå›¾
    list = list.map(item=>item.replace(/(^\s*)|(\s*$)/g, ""));
    const len = list.length;
    for (let i = 0; i < len; i++) { 
        await page.goto(userInfo.domaiName+list[i]);
        const img = await page.$('img');
        if(img){
            const boundingBox = await img.boundingBox();
            await page.screenshot({path:'./images/'+list[i],clip: boundingBox});
        }else{
            await page.screenshot({path:'./images/'+list[i]});
        }
    }

    await browser.close();
})();
```

ç„¶é¹…ï¼Œæœ‰ä¸€äº›å·²ç»é“¾æ¥å¤±æ•ˆäº†ï¼Œå·®ç‚¹åˆšåƒè¿›å»çš„è€å›é…¸èœä¸€å£åå‡ºæ¥ã€‚



##### 2.Node.js

###### 1ï¼‰å®‰è£…request

```shell
$ npm install request
```



###### 2ï¼‰å®ç°

```javascript
var fs = require('fs');
var request = require("request");

var list = ["0.png", "1542689394373.jpg", "1542690089176.jpg"];

const doMain = 'æµ‹è¯•åŸŸå';//ä½ çš„æµ‹è¯•åŸŸå

function download(name) {
    var src = doMain + name;
    var writeStream = fs.createWriteStream('images/' + name);//å›¾ç‰‡å†™å…¥ç›®æ ‡è·¯å¾„
    var readStream = request(src);
    readStream.pipe(writeStream);
    readStream.on('end', function () {
        console.log('æ–‡ä»¶ä¸‹è½½æˆåŠŸ');
    });
    readStream.on('error', function () {
        console.log("é”™è¯¯ä¿¡æ¯:" + err)
    })
    writeStream.on("finish", function () {
        console.log("æ–‡ä»¶å†™å…¥æˆåŠŸ");
        writeStream.end();
    });
}
const len = list.length;

for (let i = 0; i < len; i++) {
    download(list[i]);
}
```





æœ¬æ¥æœ‰æƒ³ä½¿ç”¨`a`æ ‡ç­¾çš„`download`å±æ€§åªæ”¯æŒåŒæºçš„URLã€‚

> å‚è€ƒèµ„æ–™ï¼š[aæ ‡ç­¾](https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/a) 

